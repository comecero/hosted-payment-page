/*
Comecero Cart version: ï»¿1.0.0
https://comecero.com
https://github.com/comecero/cart
Copyright Comecero and other contributors. Released under MIT license. See LICENSE for details.
*/

app.controller("MainController",["$scope","SettingsService","CurrencyService",function(e,t,a){e.settings=t.get(),e.currency=a.getCurrencyName()}]),app.controller("PayController",["$scope","$location","PaymentService","GeoService","CurrencyService","SettingsService","HelperService","$document",function(e,t,a,r,n,o,c,i){e.data={},e.geoService=r,e.settings=o.get(),e.helpers=c,e.data.payment={customer:{billing_address:{country:null}},payment_method:{}},e.data.shipping_is_billing=!0,e.data.payment_method={},e.data.card={type:"credit_card"},e.data.paypal={type:"paypal",data:{success_url:window.location.href.substring(0,window.location.href.indexOf("#"))+"#/review/{{payment_id}}",cancel_url:window.location.href.substring(0,window.location.href.indexOf("#"))+"#/pay"}},a.getOptions().then(function(r){e.data.options=r,e.data.countries=[],_.each(r.allowed_customer_countries,function(t){e.data.countries.push(_.findWhere(e.geoService.getData().countries,{code:t}))}),n.setCurrency(r.customer_default_currency),e.data.payment.currency=r.customer_default_currency,e.data.payment=a.fromParams(e.data.payment,t)},function(t){e.data.error=t}),e.onPaymentSuccess=function(e){switch(e.payment_method.type){case"paypal":window.location=e.response_data.redirect_url;break;default:t.path("/receipt/"+e.payment_id)}},e.$watch("data.error",function(t,a){e.data.error&&i.scrollTop(0,500)})}]),app.controller("ReceiptController",["$scope","$routeParams","PaymentService","OrderService","SettingsService","HelperService","$document",function(e,t,a,r,n,o,c){e.data={},e.helpers=o,e.data.params={},e.data.params.expand="payment_method,payment_method.data,customer",e.data.params.formatted=!0,e.data.params.options=!0,e.data.params.formatted=!0,e.customer={},a.get(t.id,e.data.params).then(function(t){e.data.payment=t},function(t){e.exception=t}),a.getOptions().then(function(t){e.options=t},function(t){e.data.error=t}),e.$watch("data.error",function(t,a){e.data.error&&c.scrollTop(0,500)})}]),app.controller("PaymentController",["$scope","$location","$routeParams","CartService","PaymentService","SettingsService","HelperService","GeoService","$document",function(e,t,a,r,n,o,c,i,d){e.data={},e.options={};t.search();e.data.payment_id=a.id,e.data.payment_id||t.path("/cart"),e.settings=o.get(),e.helpers=c,e.geoService=i,e.data.params={},e.data.params.expand="payment_method,payment_method.data,customer",n.get(e.data.payment_id,e.data.params).then(function(a){e.data.payment=a,"completed"==a.status&&t.path("/receipt/"+a.payment_id),n.getOptions().then(function(t){c.isRequiredCustomerField("company_name",t)&&null==e.data.sale.customer.company_name&&(e.options.showCompanyName=!0),c.isRequiredCustomerField("phone",t)&&null==e.data.sale.customer.phone&&(e.options.showPhone=!0)},function(t){e.data.error=t})},function(t){e.data.error=t}),e.onPaymentSuccess=function(e){"initiated"==e.status?window.location.replace(e.response_data.redirect_url):t.path("/receipt/"+e.payment_id)},e.$watch("data.error",function(t,a){e.data.error&&d.scrollTop(0,500)})}]);